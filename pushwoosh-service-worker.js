!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return c(this,void 0,void 0,function(){var t;return l(this,function(n){switch(n.label){case 0:return[4,self.clients.matchAll()];case 1:return t=n.sent(),t.forEach(function(t){return t.postMessage(e)}),[2]}})})}function i(e){return c(this,void 0,void 0,function(){var t;return l(this,function(n){switch(n.label){case 0:if(!e)return[3,4];n.label=1;case 1:return n.trys.push([1,2,,4]),[2,JSON.parse(e)];case 2:return t=n.sent(),[4,d.default.write("error",t,"Error occurred during parsing custom data")];case 3:return n.sent(),[3,4];case 4:return[2,e]}})})}function s(e){return c(this,void 0,void 0,function(){var t,n,r,s,o,a,u;return l(this,function(c){switch(c.label){case 0:return[4,h.keyValue.get(f.keyInitParams)];case 1:return t=c.sent(),d.default.setLevel(t.logLevel),[4,e.data.json()];case 2:return n=c.sent(),[4,d.default.write("info",n,"onPush")];case 3:return c.sent(),r=n.p||"",s=n.buttons||[],o=n.image||"",a=p.prepareDuration(n.duration),[4,i(n.u)];case 4:return u=c.sent(),[2,{messageHash:r,payload:n,notificationPayload:{title:n.header||t.defaultNotificationTitle||f.defaultNotificationTitle,body:n.body,icon:n.i||t.defaultNotificationImage||f.defaultNotificationImage,openUrl:n.l||f.defaultNotificationUrl,messageHash:r,customData:u,duration:a,buttons:s,image:o}}]}})})}function o(e){return c(this,void 0,void 0,function(){var t,n,i,o,a,c,f;return l(this,function(l){switch(l.label){case 0:return l.trys.push([0,4,,6]),[4,s(e)];case 1:return t=l.sent(),n=t.messageHash,i=t.payload,o=t.notificationPayload,a=new g.default(o),c=b.getListeners("onPush"),[4,c.reduce(function(e,t){return e.then(function(){return t(a)})},Promise.resolve())];case 2:return l.sent(),[4,Promise.all([a.show(),n&&b.initApi().then(function(){return b.api.messageDeliveryEvent(n)}),h.message.add(u({},a._forLog(),{payload:i})),r({type:y.eventOnPushDelivery,payload:o})])];case 3:return l.sent(),[3,6];case 4:return f=l.sent(),[4,h.message.add({error:""+f,stack:f.stack,payload:e.data.text()})];case 5:return l.sent(),[3,6];case 6:return[2]}})})}function a(e){return c(this,void 0,void 0,function(){var t,n,i,s;return l(this,function(o){switch(o.label){case 0:return t=e.notification.data,n=JSON.parse(e.notification.tag),m.push(t.code),e.notification.close(),i="",e.action&&Array.isArray(t.buttons)?(s=t.buttons.find(function(t){return t.action===e.action})||{},i=s.url):i=n.url,i?[4,self.clients.openWindow(i)]:[3,2];case 1:o.sent(),o.label=2;case 2:return[4,Promise.all([b.initApi().then(function(){return b.api.pushStat(n.messageHash)}),h.keyValue.set(f.keyLastOpenMessage,{url:i,messageHash:n.messageHash,expiry:Date.now()+f.periodGoalEvent}),r({type:y.eventOnNotificationClick,payload:u({},n,{url:i})})])];case 3:return o.sent(),[2]}})})}var u=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;r>n;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},l=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,s&&(o=s[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(s,n[1])).done)return o;switch(s=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,s=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(o=a.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){a=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&o[3]>n[1])){a.label=n[1];break}if(6===n[0]&&o[1]>a.label){a.label=o[1],o=n;break}if(o&&o[2]>a.label){a.label=o[2],a.ops.push(n);break}o[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(e){n=[6,e],s=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,s,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return{next:n(0),throw:n(1),return:n(2)}},h=n(3),f=n(2),p=n(1),d=n(5),v=n(12),g=n(13),y=n(4),b=self.Pushwoosh=new v.default,m=[];self.addEventListener("install",function(e){e.waitUntil(Promise.all([h.keyValue.set(f.keyWorkerVersion,p.getVersion()),d.default.write("info","install")]).then(function(){return self.skipWaiting()}))}),self.addEventListener("activate",function(e){console.info("activate",e),e.waitUntil(Promise.all([d.default.write("info","activate")]).then(function(){return self.clients.claim()}))}),self.addEventListener("push",function(e){e.waitUntil(o(e).catch(function(e){return console.log(e)}))}),self.addEventListener("notificationclick",function(e){e.waitUntil(a(e).catch(function(e){return console.log(e)}))}),self.addEventListener("notificationclose",function(e){var t=e.notification.data&&e.notification.data.code,n=JSON.parse(e.notification.tag);e.notification.close();var i=m.indexOf(t);0>i?r({type:y.eventOnNotificationClose,payload:n}).catch(function(e){return console.log(e)}):m.splice(i,1)})},function(e,t,n){"use strict";function r(){return Function("return this")()}function i(){return"3.0.8"}function s(){var e=r();return!!e.safari&&navigator.userAgent.indexOf("Safari")>-1}function o(){return navigator.serviceWorker&&"PushManager"in window}function a(){return s()?10:~navigator.userAgent.toLowerCase().indexOf("firefox")?12:11}function u(){var e=navigator.userAgent,t=e.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],n=null;return/trident/i.test(t[1])?(n=/\brv[ :]+(\d+)/g.exec(e)||[],"IE "+(n[1]||"")):"Chrome"===t[1]&&(n=e.match(/\bOPR\/(\d+)/),null!==n)?"Opera "+n[1]:(t=t[2]?[t[1],t[2]]:[navigator.appName,navigator.appVersion,"-?"],n=e.match(/version\/([.\d]+)/i),null!==n&&t.splice(1,1,n[1]),t.join(" "))}function c(e){for(var t="=".repeat((4-e.length%4)%4),n=(e+t).replace(/-/g,"+").replace(/_/g,"/"),r=window.atob(n),i=new Uint8Array(r.length),s=0;r.length>s;++s)i[s]=r.charCodeAt(s);return i}function l(){var e=navigator.userAgent;return e.match(/Android/i)||e.match(/webOS/i)||e.match(/iPhone/i)||e.match(/iPad/i)||e.match(/iPod/i)||e.match(/BlackBerry/i)||e.match(/Windows Phone/i)?"Phone":"PC"}function h(e){for(var t="0123456789abcdef",n="",r=0;32>r;r++){var i=e.length-r-1,s=0;0>i||(s=e.charCodeAt(i)),n+=t.substr(s%t.length,1)}return n}function f(e,t){return t=p()||t||d(),e+"_"+h(t)}function p(){return localStorage.getItem(A.keyFakePushToken)}function d(){var e=v();return localStorage.setItem(A.keyFakePushToken,e),e}function v(e){e=e||32;for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;e>r;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}function g(e){return e?e.subscriptionId?e.subscriptionId:12===a()?e.endpoint:e.endpoint.split("/").pop():""}function y(e,t){var n=e&&e.getKey&&e.getKey(t);return n?btoa(String.fromCharCode.apply(String,new Uint8Array(n))):""}function b(e){return y(e,"auth")}function m(e){return y(e,"p256dh")}function w(e,t,n){var r="cp";s()||!e||~e.indexOf(".")||(r=e+".api");var i="https://"+(n||""||r+".pushwoosh.com")+"/json/1.3/";return new Promise(function(e){t&&e(i),S.keyValue.get(A.keyApiBaseUrl).then(function(t){void 0===t&&(t=null),e(t||i)}).catch(function(){e(i)})})}function P(){for(var e,t=function(){},n=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],i=n.length,s=r(),o=s.console=s.console||{};i--;)e=n[i],o[e]||(o[e]=t)}function k(){var e=r();"Promise"in e||(e.Promise=function(){return{then:function(){},catch:function(){}}})}function O(){var e=r();"history"in e&&history.pushState?history.pushState(null,"","#"):location.hash="#"}function _(e){return isNaN(e)?20:(e=Math.round(e),Math.min(60,0>e?20:e))}var S=n(3),A=n(2);t.getGlobal=r,t.getVersion=i,t.isSafariBrowser=s,t.canUseServiceWorkers=o,t.getBrowserType=a,t.getBrowserVersion=u,t.urlB64ToUint8Array=c,t.getDeviceName=l,t.createUUID=h,t.generateHwid=f,t.getFakePushToken=p,t.generateFakePushToken=d,t.getPushToken=g,t.getAuthToken=b,t.getPublicKey=m,t.getPushwooshUrl=w,t.patchConsole=P,t.patchPromise=k,t.clearLocationHash=O,t.prepareDuration=_},function(e,t){"use strict";t.defaultServiceWorkerUrl="pushwoosh-service-worker.js",t.periodSendAppOpen=36e5,t.periodGoalEvent=864e5,t.defaultNotificationTitle="Pushwoosh notification",t.defaultNotificationImage="https://cp.pushwoosh.com/img/logo-medium.png",t.defaultNotificationUrl="/",t.keyApiParams="API_PARAMS",t.keyInitParams="INIT_PARAMS",t.keySDKVersion="SDK_VERSION",t.keyWorkerVersion="WORKER_VERSION",t.keyLastSentAppOpen="LAST_SENT_APP_OPEN",t.keyLastOpenMessage="LAST_OPEN_MESSAGE",t.keyApiBaseUrl="API_BASE_URL",t.keyFakePushToken="fakePushToken",t.keyDeviceRegistrationStatus="deviceRegistrationStatus",t.keySafariPreviousPermission="safariPreviousPermission"},function(e,t){"use strict";function n(e){console.info("onversionchange",e)}function r(){return o||(o=new Promise(function(e,t){var r=indexedDB.open("PUSHWOOSH_SDK_STORE",6);r.onsuccess=function(t){var r=t.target.result;r.onversionchange=n,e(r)},r.onerror=function(){return t(r.error)},r.onupgradeneeded=function(e){var t=e.target.result;t.onversionchange=n,t.objectStoreNames.contains(c)||t.createObjectStore(c,{keyPath:"key"});var r={keyPath:"id",autoIncrement:!0},i={unique:!1};if(!t.objectStoreNames.contains(l)){var s=t.createObjectStore(l,r);s.createIndex("environment","environment",i),s.createIndex("date","date",i),s.createIndex("type","type",i)}if(!t.objectStoreNames.contains(h)){var o=t.createObjectStore(h,r);o.createIndex("date","date",i)}}})),o}function i(e){return r().then(function(t){return new Promise(function(n,r){return e(t,n,r)})})}function s(e){return{get:function(t){return i(function(n,r,i){var s=n.transaction(e).objectStore(e).get(t);s.onsuccess=function(){var e=s.result;r(e&&e.value)},s.onerror=function(){i(s.error)}})},getAll:function(){return i(function(t,n,r){var i={},s=t.transaction(e).objectStore(e).openCursor();s.onsuccess=function(e){var t=e.target.result;t?(i[t.key]=t.value.value,t.continue()):n(i)},s.onerror=function(){r(s.error)}})},set:function(t,n){return i(function(r,i,s){var o=r.transaction([e],"readwrite").objectStore(e).put({key:t,value:n});o.onsuccess=function(){i(t)},o.onerror=function(){s(o.error)}})}}}var o,a=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},u=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;r>n;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},c="keyValue",l="logs",h="messages",f=function(){function e(){}return e.prototype._add=function(e){var t=this;return i(function(n,r,i){var s=n.transaction([t.name],"readwrite").objectStore(t.name).add(e);s.onsuccess=function(){r(e)},s.onerror=function(){i(s.error)}}).then(function(e){return t.getAll().then(function(n){if(Array.isArray(n)){var r=n.map(function(e){return e.id}).sort(function(e,t){return e==t?0:t>e?1:-1});if(r.length>t.maxItems)return Promise.all(r.slice(t.maxItems).map(function(e){return t.delete(e)})).then(function(){return e})}return e})})},e.prototype.delete=function(e){var t=this;return i(function(n,r,i){var s=n.transaction([t.name],"readwrite").objectStore(t.name).delete(e);s.onsuccess=function(){r(s.result)},s.onerror=function(){i(s.error)}})},e.prototype.getAll=function(){var e=this;return i(function(t,n,r){var i=[],s=t.transaction(e.name).objectStore(e.name).openCursor();s.onsuccess=function(e){var t=e.target.result;t?(i.push(t.value),t.continue()):n(i)},s.onerror=function(){r(s.error)}})},e}();t.LogBase=f;var p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name=l,t.maxItems=100,t.environment="undefined"!=typeof self&&self.registration?"worker":"browser",t}return a(t,e),t.prototype.add=function(e,t,n){var r={type:e,environment:this.environment,message:""+t,date:new Date};return t instanceof Error&&(r.stack=t.stack),n&&(r.additional=n),this._add(r)},t}(f);t.LogLog=p;var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name=h,t.maxItems=25,t}return a(t,e),t.prototype.add=function(e){return this._add(u({},e,{date:new Date}))},t}(f);t.LogMessage=d,t.keyValue=s(c),t.log=new p,t.message=new d},function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;r>n;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,s&&(o=s[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(s,n[1])).done)return o;switch(s=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,s=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(o=a.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){a=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&o[3]>n[1])){a.label=n[1];break}if(6===n[0]&&o[1]>a.label){a.label=o[1],o=n;break}if(o&&o[2]>a.label){a.label=o[2],a.ops.push(n);break}o[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(e){n=[6,e],s=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,s,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return{next:n(0),throw:n(1),return:n(2)}},o=n(7),a=n(6),u=n(1),c=n(2),l=n(5),h=n(10),f=n(9),p=n(8),d=n(3);t.eventOnReady="onReady",t.eventOnSubscribe="onSubscribe",t.eventOnUnsubscribe="onUnsubscribe",t.eventOnRegister="onRegister",t.eventOnPermissionPrompt="onPermissionPrompt",t.eventOnPermissionDenied="onPermissionDenied",t.eventOnPermissionGranted="onPermissionGranted",t.eventOnSWInitError="onSWInitError",t.eventOnPushDelivery="onPushDelivery",t.eventOnNotificationClick="onNotificationClick",t.eventOnNotificationClose="onNotificationClose",u.patchPromise();var v=function(){function e(){var e=this;this._ee=new o.default,this.isSafari=u.isSafariBrowser(),this.ready=!1,this.debug={showLog:function(){return i(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return[4,d.log.getAll()];case 1:return e=t.sent(),console.log(e),[2]}})})},showKeyValues:function(){return i(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return[4,d.keyValue.getAll()];case 1:return e=t.sent(),console.log(e),[2]}})})},showMessages:function(){return i(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return[4,d.message.getAll()];case 1:return e=t.sent(),e.forEach(function(e){return console.log(e)}),[2]}})})}},this._onPromises=(n={},n[t.eventOnPermissionDenied]=new Promise(function(n){return e._ee.once(t.eventOnPermissionDenied,n)}),n[t.eventOnPermissionPrompt]=new Promise(function(n){return e._ee.once(t.eventOnPermissionPrompt,n)}),n[t.eventOnPermissionGranted]=new Promise(function(n){return e._ee.once(t.eventOnPermissionGranted,n)}),n);var n}return e.prototype.onReadyHandler=function(e){var n=this;this.ready?e(this.api):this._ee.on(t.eventOnReady,function(t){return e(n.api,t)})},e.prototype.push=function(e){var n=this;if("function"==typeof e)this.onReadyHandler(e);else{if(!Array.isArray(e))throw Error("invalid command");var r=e[0],i=e[1];switch(r){case"init":this.shouldInit()&&this.init(i).catch(function(e){return l.default.info("Pushwoosh init failed",e)});break;case t.eventOnReady:this.onReadyHandler(i);break;case t.eventOnRegister:case t.eventOnSubscribe:case t.eventOnUnsubscribe:case t.eventOnSWInitError:case t.eventOnPushDelivery:case t.eventOnNotificationClick:case t.eventOnNotificationClose:this._ee.on(r,function(e){return i(n.api,e)});break;case t.eventOnPermissionDenied:case t.eventOnPermissionPrompt:case t.eventOnPermissionGranted:this._onPromises[r].then(function(){return i(n.api)});break;default:throw Error("unknown command")}}},e.prototype.shouldInit=function(){return!!(this.isSafari&&"PC"===u.getDeviceName()||u.canUseServiceWorkers())||(l.default.info("This browser does not support pushes"),!1)},e.prototype.init=function(e){return i(this,void 0,void 0,function(){var n,i,o,a,p,d,v,g,y,b,m=this;return s(this,function(s){switch(s.label){case 0:if(this._initParams=e,n=e.scope,i=e.applicationCode,o=e.logLevel,a=void 0===o?"error":o,p=e.pushwooshApiUrl,!i)throw Error("no application code");return[4,u.getPushwooshUrl(i,!1,p)];case 1:if(d=s.sent(),v=this.params=r({autoSubscribe:!0,pushwooshUrl:d},e,{deviceType:u.getBrowserType(),tags:r({Language:navigator.language||"en"},e.tags,{"Device Model":u.getBrowserVersion()}),driversSettings:{worker:r({serviceWorkerUrl:c.defaultServiceWorkerUrl},e.driversSettings&&e.driversSettings.worker)}}),l.default.setLevel(a),!u.canUseServiceWorkers())return[3,7];g=v.driversSettings.worker,this.driver=new h.default({eventEmitter:this._ee,scope:n,applicationCode:i,serviceWorkerUrl:g.serviceWorkerUrl,applicationServerPublicKey:g.applicationServerPublicKey}),s.label=2;case 2:return s.trys.push([2,5,,6]),this.driver&&this.driver.initWorker?[4,this.driver.initWorker()]:[3,4];case 3:s.sent(),s.label=4;case 4:return[3,6];case 5:return y=s.sent(),l.default.write("error",y,"driver initialization failed"),[3,6];case 6:return[3,8];case 7:if(!this.isSafari||!v.safariWebsitePushID)throw Error("can't initialize safari");this.driver=new f.default({eventEmitter:this._ee,applicationCode:i,pushwooshUrl:v.pushwooshUrl,pushwooshApiUrl:v.pushwooshApiUrl,webSitePushID:v.safariWebsitePushID}),this._ee.on(t.eventOnReady,function(){var e=/#P(.*)/,t=decodeURIComponent(document.location.hash);e.test(t)&&m.api.pushStat(e.exec(t)[1]).then(u.clearLocationHash)}),s.label=8;case 8:return s.trys.push([8,10,,11]),[4,this.defaultProcess()];case 9:return s.sent(),"serviceWorker"in navigator&&(navigator.serviceWorker.onmessage=this.onServiceWorkerMessage.bind(this)),[3,11];case 10:return b=s.sent(),l.default.write("error",b,"defaultProcess fail"),[3,11];case 11:return[2]}})})},e.prototype.onServiceWorkerMessage=function(e){var t=(e||{}).data,n=void 0===t?{}:t,r=n||{},i=r.type,s=void 0===i?"":i,o=r.payload,a=void 0===o?{}:o;this._ee.emit(s,a)},e.prototype.initApi=function(){return i(this,void 0,void 0,function(){var e,t,n,i,o;return s(this,function(s){switch(s.label){case 0:return[4,this.driver.getAPIParams()];case 1:return e=s.sent(),[4,d.keyValue.get(c.keyLastOpenMessage)];case 2:return t=s.sent()||{},n=this.params,i=r({},e,{deviceType:n.deviceType,deviceModel:n.tags["Device Model"],applicationCode:n.applicationCode,language:n.tags.Language,pushwooshApiUrl:n.pushwooshApiUrl}),n.userId&&(i.userId=n.userId),o=p.default(n.applicationCode,n.pushwooshApiUrl),this.api=new a.default(o,i,t),[2]}})})},e.prototype.subscribe=function(e){return i(this,void 0,void 0,function(){var t,n,r,i;return s(this,function(s){switch(s.label){case 0:t=(e||{}).registerLess,n=void 0!==t&&t,s.label=1;case 1:return s.trys.push([1,8,,9]),[4,this.driver.isSubscribed()];case 2:return r=s.sent(),[4,this.driver.askSubscribe(n)];case 3:return s.sent(),n?[3,5]:[4,this.registerDuringSubscribe()];case 4:s.sent(),s.label=5;case 5:return r?[3,7]:[4,this.onSubscribeEmitter()];case 6:s.sent(),s.label=7;case 7:return[3,9];case 8:return i=s.sent(),l.default.write("error",i,"subscribe fail"),[3,9];case 9:return[2]}})})},e.prototype.registerDuringSubscribe=function(){return i(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return[4,this.driver.isSubscribed()];case 1:return e=t.sent(),[4,this.initApi()];case 2:return t.sent(),this.isSafari?[4,this.open()]:[3,4];case 3:t.sent(),t.label=4;case 4:return[4,this.register(e)];case 5:return t.sent(),[2]}})})},e.prototype.onSubscribeEmitter=function(){return i(this,void 0,void 0,function(){var e;return s(this,function(n){switch(n.label){case 0:return[4,this.driver.isSubscribed()];case 1:return e=n.sent(),e&&this._ee.emit(t.eventOnSubscribe),[2]}})})},e.prototype.unsubscribe=function(){return i(this,void 0,void 0,function(){var e;return s(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,this.driver.unsubscribe()];case 1:return n.sent(),[4,this.api.unregisterDevice()];case 2:return n.sent(),this._ee.emit(t.eventOnUnsubscribe),[3,4];case 3:return e=n.sent(),l.default.write("error",e,"Error occurred during the unsubscribe"),[3,4];case 4:return[2]}})})},e.prototype.isDeviceRegistered=function(){return"registered"===localStorage.getItem(c.keyDeviceRegistrationStatus)},e.prototype.isSubscribed=function(){var e=this.isSafari||this.isDeviceRegistered();return e&&this.driver.isSubscribed()||Promise.resolve(!1)},e.prototype.register=function(e){return i(this,void 0,void 0,function(){var n,i,o,a,l,h,f,p,v,g;return s(this,function(s){switch(s.label){case 0:if(!this.api)throw Error("API is not inited");return[4,d.keyValue.getAll()];case 1:return n=s.sent(),i=c.keySDKVersion,o=n[i],a=c.keyApiParams,l=n[a],h=c.keyInitParams,f=n[h],[4,this.driver.getAPIParams()];case 2:return p=s.sent(),v=this.params,g=!(u.getVersion()===o&&JSON.stringify(l)===JSON.stringify(p)&&JSON.stringify(f)===JSON.stringify(v)),g||e?[4,Promise.all([d.keyValue.set(c.keyApiParams,p),d.keyValue.set(c.keyInitParams,v),d.keyValue.set(c.keySDKVersion,u.getVersion()),this.api.registerDevice(),this.api.setTags(r({},v.tags)),this.api.registerUser()])]:[3,4];case 3:s.sent(),this._ee.emit(t.eventOnRegister),s.label=4;case 4:return[2]}})})},e.prototype.open=function(){return i(this,void 0,void 0,function(){var e,t,n,r,i;return s(this,function(s){switch(s.label){case 0:return[4,this.driver.getAPIParams()];case 1:return e=s.sent(),t=Date.now(),[4,d.keyValue.get(c.keyLastSentAppOpen)];case 2:return n=s.sent(),r=isNaN(n)?0:+n,[4,this.needForcedOpen()];case 3:return i=s.sent(),this.isSafari&&!e.hwid?[2,Promise.resolve()]:i||t-r>c.periodSendAppOpen?[4,Promise.all([d.keyValue.set(c.keyLastSentAppOpen,t||Date.now()),this.api.applicationOpen()])]:[3,5];case 4:s.sent(),s.label=5;case 5:return[2]}})})},e.prototype.needForcedOpen=function(){return i(this,void 0,void 0,function(){var e,t,n,r;return s(this,function(i){switch(i.label){case 0:return this.isSafari?[4,d.keyValue.get(c.keySafariPreviousPermission)]:[2,Promise.resolve(!1)];case 1:return e=i.sent(),[4,this.driver.getPermission()];case 2:return t=i.sent(),n=function(e,t){return"granted"!==e&&"granted"===t},[4,d.keyValue.set(c.keySafariPreviousPermission,t)];case 3:return i.sent(),r=n(this.permissionOnInit,t)||n(e,t),[2,Promise.resolve(r)]}})})},e.prototype.defaultProcess=function(){return i(this,void 0,void 0,function(){var e,n,r,i;return s(this,function(s){switch(s.label){case 0:return e=(this.params||{}).autoSubscribe,n=void 0===e||e,r=this,[4,this.driver.getPermission()];case 1:return r.permissionOnInit=s.sent(),[4,this.initApi()];case 2:switch(s.sent(),i=this.permissionOnInit){case"denied":return[3,3];case"prompt":return[3,6];case"granted":return[3,12]}return[3,15];case 3:return this._ee.emit(t.eventOnPermissionDenied),this.isSafari||!this.isDeviceRegistered()?[3,5]:[4,this.unsubscribe()];case 4:s.sent(),s.label=5;case 5:return[3,16];case 6:return this.isSafari||!this.isDeviceRegistered()?[3,8]:[4,this.unsubscribe()];case 7:s.sent(),s.label=8;case 8:return n?[4,this.subscribe({registerLess:!0})]:[3,10];case 9:return s.sent(),[3,11];case 10:this._ee.emit(t.eventOnPermissionPrompt),s.label=11;case 11:return[3,16];case 12:return this._ee.emit(t.eventOnPermissionGranted),this.isSafari||this.isDeviceRegistered()?[3,14]:[4,this.subscribe({registerLess:!0})];case 13:s.sent(),s.label=14;case 14:return[3,16];case 15:l.default.write("error",this.permissionOnInit,"unknown permission value"),s.label=16;case 16:return[4,this.initApi()];case 17:return s.sent(),[4,this.open()];case 18:return s.sent(),[4,this.register()];case 19:return s.sent(),this._ee.emit(t.eventOnReady),this.ready=!0,[2]}})})},e.prototype.getHWID=function(){return i(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return[4,this.driver.getAPIParams()];case 1:return e=t.sent().hwid,[2,Promise.resolve(e)]}})})},e.prototype.getPushToken=function(){return i(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return[4,this.driver.getAPIParams()];case 1:return e=t.sent().pushToken,[2,Promise.resolve(e)]}})})},e.prototype.getUserId=function(){return i(this,void 0,void 0,function(){var e;return s(this,function(t){return e=this.params||{},[2,Promise.resolve(e.userId)]})})},e.prototype.getParams=function(){return i(this,void 0,void 0,function(){var e,t;return s(this,function(n){return e=(this.api||{}).params,t=void 0===e?{}:e,[2,Promise.resolve(t)]})})},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=v},function(e,t,n){"use strict";function r(e){var t=Error(e);throw c.write("error",t,"logAndThrowError"),t}function i(e,t){var n=Error(e);c.write("error",n,"logAndRejectError"),t(n)}var s=n(3),o=n(1),a={error:1,info:2,debug:3},u=3;o.patchConsole();var c={setLevel:function(e){a[e]||(e="error"),u=a[e]},write:function(e,t,n){return"error"===e?this.error(t):this.info(t),s.log.add(e,t,n)}};Object.keys(a).forEach(function(e){var t=a[e];c[e]=function(){for(var n=[],r=0;arguments.length>r;r++)n[r]=arguments[r];t>u||(console.info.apply(console,[e].concat(n)),console.trace("trace"))}}),t.logAndThrowError=r,t.logAndRejectError=i,Object.defineProperty(t,"__esModule",{value:!0}),t.default=c},function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;r>n;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},i=n(2),s=n(1),o=function(){function e(e,t,n){this.doPushwooshApiMethod=e,this.params=t,this.lastOpenMessage=n,this.timezone=60*-(new Date).getTimezoneOffset()}return Object.defineProperty(e.prototype,"isSafari",{get:function(){return s.isSafariBrowser()},enumerable:!0,configurable:!0}),e.prototype.callAPI=function(e,t){var n=this.params||{},i=n.hwid,s=void 0===i?"":i,o=n.applicationCode,a=void 0===o?"":o,u=n.userId,c=void 0===u?"":u;if(this.isSafari&&!s)return Promise.resolve();var l=t&&t.userId,h={application:a,hwid:s,userId:l||c||s};return this.doPushwooshApiMethod(e,r({},t,h))},e.prototype.registerDevice=function(){var e=this,t=this.params;return!t.pushToken||this.isSafari?Promise.resolve():new Promise(function(n,r){e.callAPI("registerDevice",{push_token:t.pushToken,public_key:t.publicKey,auth_token:t.authToken,language:t.language,timezone:e.timezone,device_model:t.deviceModel,device_type:t.deviceType}).then(function(){localStorage.setItem(i.keyDeviceRegistrationStatus,"registered"),n()}).catch(r)})},e.prototype.unregisterDevice=function(){var e=this;return this.isSafari?Promise.resolve():new Promise(function(t,n){e.callAPI("unregisterDevice").then(function(){localStorage.setItem(i.keyDeviceRegistrationStatus,""),t()}).catch(n)})},e.prototype.registerUser=function(e){var t={timezone:this.timezone,device_type:this.params.deviceType,userId:this.params.userId};return e&&(t.userId=e),t.userId?this.callAPI("registerUser",t):Promise.resolve()},e.prototype.applicationOpen=function(){return this.callAPI("applicationOpen",{push_token:this.params.pushToken,device_type:this.params.deviceType,timezone:this.timezone})},e.prototype.setTags=function(e){return this.callAPI("setTags",{tags:e})},e.prototype.getTags=function(){return this.callAPI("getTags")},e.prototype.pushStat=function(e){return this.callAPI("pushStat",{hash:e})},e.prototype.messageDeliveryEvent=function(e){return this.callAPI("messageDeliveryEvent",{hash:e})},e.prototype.postEvent=function(e,t){var n=this.lastOpenMessage,i=new Date,s=i.getTime(),o=Math.floor(s/1e3),a=o-i.getTimezoneOffset()/60*3600;if(n.expiry>Date.now()){if(t.msgHash)return Promise.reject("attribute msgHash already defined");t=r({},t,{msgHash:n.messageHash})}return this.callAPI("postEvent",{device_type:this.params.deviceType,event:e,attributes:t,timestampUTC:o,timestampCurrent:a})},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=o},function(e,t){"use strict";var n=function(){function e(){this._events={}}return e.prototype.emit=function(e,t){var n=this._events[e]&&this._events[e].slice();if(n&&n.length)for(var r=0;n.length>r;r++)n[r](t)},e.prototype.on=function(e,t){return this._events[e]||(this._events[e]=[]),this._events[e].push(t),this},e.prototype.once=function(e,t){var n=this,r=!1,i=function(s){if(!r)return r=!0,n.removeListener(e,i),t(s)};return this.on(e,i)},e.prototype.removeListener=function(e,t){var n=this._events[e];if(n){var r=n.indexOf(t);r>-1&&n.splice(r,1),1>n.length&&delete this._events[e]}},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t,n){"use strict";function r(e,t){return function(n,r){return new Promise(function(u,c){a.getPushwooshUrl(e,!1,t).then(function(e){try{var t=""+e+n,a={request:r},l=new XMLHttpRequest;l.open("POST",t,!0),l.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),l.onload=function(){if(200==l.status)try{var e=JSON.parse(l.responseText),t=(e||{}).base_url,a=void 0===t?null:t;a&&s.keyValue.set(o.keyApiBaseUrl,a),200==e.status_code?(i.default.write("apirequest",n+" call with arguments: "+JSON.stringify(r)+" to Pushwoosh has been successful. Result: "+JSON.stringify(e.response),"createDoApiXHR"),u(e.response)):(s.keyValue.set(o.keyApiBaseUrl,null),i.logAndRejectError("Error occurred during the "+n+" call to Pushwoosh: "+e.status_message,c))}catch(e){s.keyValue.set(o.keyApiBaseUrl,null),i.logAndRejectError("Error parse responce: "+e,c)}else s.keyValue.set(o.keyApiBaseUrl,null),i.logAndRejectError("Error occurred, status code: "+l.status,c)},l.onerror=function(e){i.logAndRejectError("Pushwoosh response to "+n+" call in not ok: "+e,c)},l.send(JSON.stringify(a))}catch(e){i.logAndRejectError("Exception while "+n+" the device: "+e,c)}})})}}var i=n(5),s=n(3),o=n(2),a=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,s&&(o=s[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(s,n[1])).done)return o;switch(s=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,s=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(o=a.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){a=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&o[3]>n[1])){a.label=n[1];break}if(6===n[0]&&o[1]>a.label){a.label=o[1],o=n;break}if(o&&o[2]>a.label){a.label=o[2],a.ops.push(n);break}o[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(e){n=[6,e],s=0}finally{i=o=0}if(5&n[0])throw n[1];
return{value:n[0]?n[1]:void 0,done:!0}}var i,s,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return{next:n(0),throw:n(1),return:n(2)}},s=n(4),o=n(1),a=function(){function e(e){this.params=e}return e.prototype.getPermissionObject=function(){return safari.pushNotification.permission(this.params.webSitePushID)},e.prototype.getPermission=function(){return r(this,void 0,void 0,function(){var e;return i(this,function(t){return e=this.getPermissionObject().permission,[2,"default"===e?"prompt":e]})})},e.prototype.isSubscribed=function(){return r(this,void 0,void 0,function(){var e;return i(this,function(t){switch(t.label){case 0:return[4,this.getPermission()];case 1:return e=t.sent(),[2,"granted"===e]}})})},e.prototype.askSubscribe=function(){var e=this.params||{},t=e.eventEmitter,n=void 0===t?{emit:function(e){return e}}:t,r=e.applicationCode,i=void 0===r?"":r,a=e.webSitePushID,u=void 0===a?"":a,c=e.pushwooshApiUrl,l=void 0===c?"":c;return new Promise(function(e,t){o.getPushwooshUrl(i,!0,l).then(function(r){safari.pushNotification.requestPermission(r+"safari",u,{application:i},function(r){"granted"===r.permission?(n.emit(s.eventOnPermissionGranted),e(!0)):(n.emit(s.eventOnPermissionDenied),t(!1))})})})},e.prototype.unsubscribe=function(){return new Promise(function(e){return e(!0)})},e.prototype.getAPIParams=function(){return r(this,void 0,void 0,function(){var e,t,n,r;return i(this,function(i){return e=(this.getPermissionObject()||{}).deviceToken,t=void 0===e?"":e,n=t&&t.toLowerCase()||"",r=t&&t.toUpperCase()||"",[2,{hwid:n,pushToken:r}]})})},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=a},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,s&&(o=s[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(s,n[1])).done)return o;switch(s=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,s=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(o=a.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){a=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&o[3]>n[1])){a.label=n[1];break}if(6===n[0]&&o[1]>a.label){a.label=o[1],o=n;break}if(o&&o[2]>a.label){a.label=o[2],a.ops.push(n);break}o[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(e){n=[6,e],s=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,s,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return{next:n(0),throw:n(1),return:n(2)}},s=n(1),o=n(4),a=n(2),u=n(3),c=function(){function e(e){this.params=e}return Object.defineProperty(e.prototype,"scope",{get:function(){var e=(this.params||{}).scope,t=void 0===e?"/":e;if("string"!=typeof t)throw Error("invalid scope value");return t.length>1&&("/"!==t.substr(0,1)&&(t="/"+t),"/"!==t.substr(t.length-1)&&(t+="/")),t},enumerable:!0,configurable:!0}),e.prototype.initWorker=function(){return r(this,void 0,void 0,function(){var e,t;return i(this,function(n){switch(n.label){case 0:return e=this.scope,[4,navigator.serviceWorker.getRegistration()];case 1:return t=n.sent(),t&&null!=t.installing?[3,3]:[4,navigator.serviceWorker.register(""+e+this.params.serviceWorkerUrl+"?version="+s.getVersion(),{scope:e})];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.getPermission=function(){return r(this,void 0,void 0,function(){return i(this,function(e){return[2,"default"===Notification.permission?"prompt":Notification.permission]})})},e.prototype.isSubscribed=function(){return r(this,void 0,void 0,function(){var e,t;return i(this,function(n){switch(n.label){case 0:return[4,navigator.serviceWorker.getRegistration()];case 1:return e=n.sent(),e?[4,e.pushManager.getSubscription()]:[2,!1];case 2:return t=n.sent(),[2,!!t]}})})},e.prototype.emit=function(e){var t=(this.params||{}).eventEmitter,n=void 0===t?{emit:function(e){return e}}:t;n.emit(e)},e.prototype.askSubscribe=function(e){return r(this,void 0,void 0,function(){var t,n,r,a,u;return i(this,function(i){switch(i.label){case 0:return[4,navigator.serviceWorker.ready];case 1:return t=i.sent(),[4,t.pushManager.getSubscription()];case 2:if(n=i.sent(),r={userVisibleOnly:!0},11==s.getBrowserType()&&this.params.applicationServerPublicKey&&(r.applicationServerKey=s.urlB64ToUint8Array(this.params.applicationServerPublicKey)),n)return[3,7];i.label=3;case 3:return i.trys.push([3,5,,6]),[4,t.pushManager.subscribe(r)];case 4:return n=i.sent(),this.emit(o.eventOnPermissionGranted),[3,6];case 5:return a=i.sent(),this.emit(o.eventOnPermissionDenied),[3,6];case 6:return[3,14];case 7:return e&&n.unsubscribe?[4,n.unsubscribe()]:[3,13];case 8:i.sent(),i.label=9;case 9:return i.trys.push([9,11,,12]),[4,t.pushManager.subscribe(r)];case 10:return n=i.sent(),this.emit(o.eventOnPermissionGranted),[3,12];case 11:return u=i.sent(),this.emit(o.eventOnPermissionDenied),[3,12];case 12:return[3,14];case 13:this.emit(o.eventOnPermissionGranted),i.label=14;case 14:return[2,n]}})})},e.prototype.unsubscribe=function(){return r(this,void 0,void 0,function(){var e,t;return i(this,function(n){switch(n.label){case 0:return[4,navigator.serviceWorker.getRegistration()];case 1:return e=n.sent(),e?[4,e.pushManager.getSubscription()]:[2,Promise.resolve()];case 2:return t=n.sent(),t&&t.unsubscribe?[2,t.unsubscribe()]:[2,Promise.resolve(!1)]}})})},e.prototype.getAPIParams=function(){return r(this,void 0,void 0,function(){var e,t,n,r,c;return i(this,function(i){switch(i.label){case 0:return[4,navigator.serviceWorker.getRegistration()];case 1:return(e=i.sent())?[3,3]:(t=a.keyApiParams,[4,u.keyValue.getAll()]);case 2:if(n=i.sent()[t],n&&"/"!==this.scope)return[2,n];throw this.emit(o.eventOnSWInitError),Error("No service worker registration");case 3:return[4,navigator.serviceWorker.ready];case 4:return e=i.sent(),[4,e.pushManager.getSubscription()];case 5:return r=i.sent(),c=s.getPushToken(r),[2,{hwid:s.generateHwid(this.params.applicationCode,c),pushToken:c,publicKey:s.getPublicKey(r),authToken:s.getAuthToken(r)}]}})})},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=c},function(e,t,n){"use strict";function r(e,t){return function(n,r){return new Promise(function(o,a){s.getPushwooshUrl(e,!1,t).then(function(e){try{var t=""+e+n,s={request:r};fetch(t,{method:"post",headers:{"Content-Type":"text/plain;charset=UTF-8"},body:JSON.stringify(s)}).then(function(e){e.ok?e.json().then(function(e){200!=e.status_code?i.logAndRejectError("Error occurred during the "+n+" call to Pushwoosh: "+e.status_message,a):(i.default.write("apirequest",n+" call with arguments: "+JSON.stringify(r)+" to Pushwoosh has been successful. Result: "+JSON.stringify(e.response),"createDoApiFetch"),o(e.response))}):i.logAndRejectError(e.statusText||"response not ok",a)})}catch(e){i.logAndRejectError("Exception while "+n+" the device: "+e,a)}})})}}var i=n(5),s=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;r>n;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,s&&(o=s[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(s,n[1])).done)return o;switch(s=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,s=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(o=a.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){a=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&o[3]>n[1])){a.label=n[1];break}if(6===n[0]&&o[1]>a.label){a.label=o[1],o=n;break}if(o&&o[2]>a.label){a.label=o[2],a.ops.push(n);break}o[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(e){n=[6,e],s=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,s,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return{next:n(0),throw:n(1),return:n(2)}},o=n(3),a=n(2),u=n(6),c=n(11),l=function(){function e(){this._listeners={}}return e.prototype.push=function(e){Array.isArray(e)&&"onPush"===e[0]&&"function"==typeof e[1]&&(this._listeners[e[0]]||(this._listeners[e[0]]=[]),this._listeners[e[0]].push(e[1]))},e.prototype.getListeners=function(e){return this._listeners[e]||[]},e.prototype.initApi=function(){return i(this,void 0,void 0,function(){var e,t,n,i,l,h;return s(this,function(s){switch(s.label){case 0:return[4,o.keyValue.getAll()];case 1:return e=s.sent(),t=e[a.keyInitParams],n=e[a.keyApiParams],i=e[a.keyLastOpenMessage]||{},l=r({},n,{deviceType:t.deviceType,deviceModel:t.tags["Device Model"],applicationCode:t.applicationCode,language:t.tags.Language,pushwooshApiUrl:t.pushwooshApiUrl}),t.userId&&(l.userId=t.userId),h=c.default(t.applicationCode,t.pushwooshApiUrl),this.api=new u.default(h,l,i),[2]}})})},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=l},function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;r>n;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,s&&(o=s[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(s,n[1])).done)return o;switch(s=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,s=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(o=a.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){a=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&o[3]>n[1])){a.label=n[1];break}if(6===n[0]&&o[1]>a.label){a.label=o[1],o=n;break}if(o&&o[2]>a.label){a.label=o[2],a.ops.push(n);break}o[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(e){n=[6,e],s=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,s,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return{next:n(0),throw:n(1),return:n(2)}},o=n(1),a=function(){function e(e){this._canceled=!1,this._origMess=e,this._changedMess=r({},e)}return Object.defineProperty(e.prototype,"title",{get:function(){return this._changedMess.title},set:function(e){this._changedMess.title=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"body",{get:function(){return this._changedMess.body},set:function(e){this._changedMess.body=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"icon",{get:function(){return this._changedMess.icon},set:function(e){this._changedMess.icon=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"openUrl",{get:function(){return this._changedMess.openUrl},set:function(e){this._changedMess.openUrl=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return o.prepareDuration(this._changedMess.duration)},set:function(e){this._changedMess.duration=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"messageHash",{get:function(){return this._changedMess.messageHash},set:function(e){this._changedMess.messageHash=e},enumerable:!0,configurable:!0}),e.prototype.show=function(){return i(this,void 0,void 0,function(){var e,t,n,r,i,o=this;return s(this,function(s){switch(s.label){case 0:return this._canceled?[3,3]:(e="notificationCode-"+Date.now(),t=this._changedMess,n=t.buttons,r=t.image,n.forEach(function(e,t){e.action="action-"+t}),[4,self.registration.showNotification(this.title,{body:this.body,icon:this.icon,requireInteraction:0===this.duration||this.duration>20,tag:JSON.stringify({url:this.openUrl,messageHash:this.messageHash}),data:{code:e,buttons:n},actions:n,image:r})]);case 1:return s.sent(),[4,self.registration.getNotifications()];case 2:i=s.sent(),i.forEach(function(t){t.data&&t.data.code===e&&o.duration&&setTimeout(function(){return t.close()},1e3*o.duration)}),s.label=3;case 3:return[2]}})})},e.prototype.cancel=function(){this._canceled=!0},e.prototype._forLog=function(){return{orig:this._origMess,changed:this._changedMess,canceled:this._canceled}},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=a}]);
//# sourceMappingURL=pushwoosh-service-worker.js.map
